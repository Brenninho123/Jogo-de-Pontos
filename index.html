<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Jogo de Pontos Avançado</title>
<style>
    body {
        margin: 0;
        height: 100vh;
        background: linear-gradient(135deg, #1e1e2f, #3a3a5c);
        font-family: 'Arial', sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        color: #fff;
    }

    h1 { font-size: 3rem; margin-bottom: 30px; }

    #score, #record { font-size: 2.5rem; margin: 5px; }

    button {
        padding: 12px 25px;
        font-size: 1.2rem;
        margin: 5px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        background: #ff6b6b;
        color: white;
        box-shadow: 0 4px #c74444;
        transition: 0.2s;
    }

    button:active {
        transform: translateY(2px);
        box-shadow: 0 2px #c74444;
    }

    button:hover { background: #ff8787; }

    #loader { font-size: 1.2rem; margin-bottom: 15px; color: #ddd; }

    /* Partículas bônus */
    .particle {
        position: absolute;
        width: 6px;
        height: 6px;
        background: gold;
        border-radius: 50%;
        pointer-events: none;
        animation: particleMove 0.8s forwards;
    }

    @keyframes particleMove {
        0% { opacity: 1; transform: translate(0,0) scale(1); }
        100% { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(0); }
    }
</style>
</head>
<body>
<h1>Jogo de Pontos Avançado</h1>
<div id="loader">Carregando módulo C++...</div>
<div id="score">Pontuação: 0</div>
<div id="record">Recorde: 0</div>
<button id="addBtn">Adicionar Ponto</button>
<button id="resetBtn">Resetar</button>

<audio id="clickSound" src="click.mp3"></audio>
<audio id="bonusSound" src="bonus.mp3"></audio>

<script src="game.js"></script>

<script>
let score = 0;
let record = localStorage.getItem('record') ? parseInt(localStorage.getItem('record')) : 0;

const scoreEl = document.getElementById('score');
const recordEl = document.getElementById('record');
const clickSound = document.getElementById('clickSound');
const bonusSound = document.getElementById('bonusSound');

scoreEl.innerText = `Pontuação: ${score}`;
recordEl.innerText = `Recorde: ${record}`;

document.getElementById('addBtn').disabled = true;
document.getElementById('resetBtn').disabled = true;

// Atualiza a pontuação e recorde
function updateScore() {
    scoreEl.innerText = `Pontuação: ${score}`;
    if(score > record) {
        record = score;
        recordEl.innerText = `Recorde: ${record}`;
        localStorage.setItem('record', record);
    }
}

// Cria partículas bônus
function createParticles(x, y, count = 10) {
    for(let i=0; i<count; i++){
        const p = document.createElement('div');
        p.className = 'particle';
        const dx = (Math.random()*100 - 50) + 'px';
        const dy = (Math.random()*-100 - 50) + 'px';
        p.style.left = x + 'px';
        p.style.top = y + 'px';
        p.style.setProperty('--dx', dx);
        p.style.setProperty('--dy', dy);
        document.body.appendChild(p);
        setTimeout(()=>p.remove(), 800);
    }
}

// Função adicionar ponto
function addPoint() {
    if(typeof Module !== 'undefined') {
        const prevScore = score;
        score = Module.ccall('addPoint', 'number', ['number'], [score]);
        updateScore();
        clickSound.currentTime = 0;
        clickSound.play();

        if(score - prevScore > 1) { // ganhou bônus
            bonusSound.currentTime = 0;
            bonusSound.play();
            createParticles(window.innerWidth/2, window.innerHeight/2, 15);
        }
    }
}

// Resetar pontuação
function resetScore() {
    if(typeof Module !== 'undefined') {
        score = Module.ccall('resetPoints', 'number', [], []);
        updateScore();
    }
}

// Espera WebAssembly carregar
var checkModule = setInterval(()=>{
    if(typeof Module !== 'undefined' && Module.calledRun) {
        clearInterval(checkModule);
        document.getElementById('loader').style.display = 'none';
        document.getElementById('addBtn').disabled = false;
        document.getElementById('resetBtn').disabled = false;
        Module.ccall('initRandom','void',[],[]);
        document.getElementById('addBtn').onclick = addPoint;
        document.getElementById('resetBtn').onclick = resetScore;
    }
}, 100);
</script>
</body>
</html>